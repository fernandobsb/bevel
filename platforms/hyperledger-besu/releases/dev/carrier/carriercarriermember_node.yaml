apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: carriercarriermember-node
  namespace: carrier-bes
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: carriercarriermember-node
  interval: 1m
  chart:
   spec:
    chart: platforms/hyperledger-besu/charts/node_besu
    sourceRef:
      kind: GitRepository
      name: flux-dev
      namespace: flux-dev
  values:
    metadata:
      namespace: carrier-bes
      labels:
    replicaCount: 1
    staticnodes:
      - "enode://d9951a5bbee5b297663681297d73e67ea6aace3040a7bc1ed1fbbb3da8aca4c53b2360557ec639a6f56b145537e69a32415f0ab9f401fc65a516f8a53a56712f@validator1.supplychain-bes.svc.cluster.local:30303"
      - "enode://2b40b1dc1a37542a8387376f71f426d1e5ddc2b0753b4c052a3055c78d7320fdf07e7b26a1872b68931d01ca9c2ee3ba2bccfe5f719fd9f56ecb9218419412ee@validator2.supplychain-bes.svc.cluster.local:30303"
      - "enode://5f222a074258f3b9eacb64efa7df44f3685878e062e692b1d08e01b4f26b71e0fd3054882d43c28ba4dcef19fe5f6335c5c039b8159079c70914721cf0c4e381@validator3.supplychain-bes.svc.cluster.local:30303"
      - "enode://be0b55844fffaf9a6c8fe9151fa3c1a9d9afd9b30f7ae96156092825c8798f9b9fadf81f80a14d6e40892a592c53aa2953b8cc9c41cf449ea5a1862e83180219@validator4.supplychain-bes.svc.cluster.local:30303"
      - "enode://3d86f6132bdf70e31fe61c59950f7103d119f2fee3f668ede27931ca0833b843b14eb5b6ecdaf43f057304a156ad51607cad650a7224155ef5fdd916b31e0009@carrier.carrier-bes.svc.cluster.local:30303"
      - "enode://da58082c5d64f151d248b9c775994bb79df70af01683f0ee0b8ca45c73fa94e00ef82df459d0b43356d06d14a2536c9185c8edca437736d384f54295cd9ebbf3@manufacturer.manufacturer-bes.svc.cluster.local:30303"
      - "enode://211c457ee222545522f0fd317ad9655d71e8415d45cd457685307c3066c33e4dd53485b3f307e55fa295bcd9a777c376e50945c138edfc1a490469832b55cd32@store.store-bes.svc.cluster.local:30303"
      - "enode://75159a3cc9db550bd4a2a729b1e23756659fae5edf483db3cd26b0136999ff77d96bba11854ff4e9f17d1211fbbd72cb4acc70dc45b61cd09fb990d7e4af60f2@warehouse.warehouse-bes.svc.cluster.local:30303"

    liveliness_check:
      enabled: false
    healthcheck:
      readinessthreshold: 100
      readinesscheckinterval: 5
    proxy:
      provider: none
      external_url: carrier.carrier-bes
      p2p: 30303
      rpc: 8545

    images:
      node: hyperledger/besu:21.10.6
      alpineutils: ghcr.io/hyperledger/bevel-alpine:latest
      pullPolicy: IfNotPresent

    node:
      name: carrier
      consensus: ibft
      subject: O=Carrier,OU=Carrier,L=51.50/-0.13/London,C=GB
      mountPath: /opt/besu/data
      servicetype: ClusterIP
      imagePullSecret: regcred
      ports:
        p2p: 30303
        rpc: 8545
        ws: 8546

      permissioning:
        enabled: False

    tm:
      type: tessera
      tls: True
      url: "https://carrier-tessera.carrier-bes:8888"

    privacy:
      enabled: true
      public_key_file: /secrets/tm_key.pub
      tm_flag: true

    storage:
      storageclassname: awsstorageclass
      storagesize: 1Gi

    vault:
      address: http://172.21.122.44:8200
      secretengine: secretsv2
      secretprefix: data/carrier-bes/crypto/carrier
      serviceaccountname: vault-auth
      keyname: data
      tmdir: tm
      tlsdir: tls
      role: vault-role
      type: hashicorp
      authpath: besucarrier

    genesis: 

   
    labels:  
      service:
        - component: besu
      pvc:
      deployment:
        - owner: bevel
        - component: besu
 

    metrics:
      enabled: False
      port: 9545
